<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CommandCatcher: CommandCatcher - a simple Arduino library for getting commands through the serial interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CommandCatcher
   </div>
   <div id="projectbrief">Helps obtain commands from attached host.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CommandCatcher - a simple Arduino library for getting commands through the serial interface </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_readme"></a></p>
<p>by <a href="https://github.com/msnicklous/">Martin Scott Nicklous</a> | <a href="https://github.com/msnicklous/CommandCatcher/">Github Project Page</a></p>
<p>Released under the MIT License</p>
<hr  />
 <h1 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Overview</h1>
<p>Sometimes when your arduino is connected to a serial interface, you want to be able to obtain and process commands through that interface. For example, yo u might want to send commands to a test harness to cause certain actions to happen.</p>
<p>If you have a more complicated program that maybe uses a number of class and header files, all compiled and linked together, you might want individual classes or modules to process their own commands in order to retain separation of concerns.</p>
<p>The <span class="tt">CommandCatcher</span> can help you do such things.</p>
<p>See <a href="https://msnicklous.github.io/CommandCatcher/">API Documentation</a></p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Concepts</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
General Operation</h2>
<p>The <span class="tt">CommandCatcher</span> monitors the serial interface, receiving ASCII characters as they arrive. When the terminating character ('<br  />
', configurable) arrives, the <span class="tt">CommandCatcher</span> parses the command into command and parameter strings and calls registered listeners for command processing. Each listener should each handle the commands it's interested in while ignoring the rest by simply returning. After all listeners have been called, the internal buffer will be reinitialized for the subsequent command.</p>
<p>If no listeners are registered, the sketch can poll <span class="tt">CommandCatcher</span> to determine if a command is available for processing and use <span class="tt">CommandCatcher</span> methods to obtain the information and also to mark command processing as completed.</p>
<p>If a command arrives, but is not processed before the next command begins arriving, the first command will be overwritten and lost. This is usually only a problem if no command listeners are registered.</p>
<p>The sketch calls the <span class="tt">CommandCatcher.update()</span> method at the top of the loop() function in order to make the magic work.</p>
<p>The <span class="tt">CommandCatcher</span> expects to be the only module monitoring serial input. If other code is also monitoring and manipulating incoming serial data, there might occur tricky-to-find problems.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Command Format</h2>
<p>The <span class="tt">CommandCatcher</span> imposes a structure on the data received. In general, it looks like this: </p><div class="fragment"><div class="line">&lt;ASCII characters (command)&gt;&lt;separator&gt;&lt;ASCII characters (parameter string)&gt;&lt;terminator&gt;</div>
</div><!-- fragment --><p> The first separator character encountered separates the command from the parameter string, so the parameter string may also contain separator characters without causing problems.</p>
<p>By default, the separator character is a blank ' ' and the terminator is a new line character '<br  />
', so the following would be a valid command string: </p><div class="fragment"><div class="line">&quot;Greeting Hello Bob!\n&quot;</div>
</div><!-- fragment --><hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Arduino Code</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md14"></a>
Getting Started</h2>
<p>To begin, include the <span class="tt">CommandCatcher</span> Library at the top of your sketch.</p>
<div class="fragment"><div class="line">#include &lt;CommandCatcher.h&gt;</div>
</div><!-- fragment --><p>This will provide a global instance of the <span class="tt">CommandCatcher</span> class called CCatcher for your convenience. By default, <span class="tt">CommandCatcher</span> uses the standard <span class="tt">Serial</span> stream for input, but a method is provided for using a different stream if you need to. <span class="tt">CommandCatcher</span> needs to be initialized during the <span class="tt">setup()</span> function of your sketch, and since it uses <span class="tt">Serial</span> (or other stream), that needs to be initialized as well:</p>
<div class="fragment"><div class="line">setup() {</div>
<div class="line">  ...</div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  CCatcher.init();</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>If the init() function is not called, commands will neither be received nor processed. Calls to other <span class="tt">CommandCatcher</span> methods will be ignored.</p>
<p>If needed, you can also suppy a serial stream other than the standard <span class="tt">Serial</span> object to <span class="tt">CommandCatcher</span> during <span class="tt">init()</span>. Also, <span class="tt">CommandCatcher</span> uses a default buffer size of 16 characters, but if you want a different size, you can specify that in the init call as well:</p>
<div class="fragment"><div class="line">setup() {</div>
<div class="line">  ...</div>
<div class="line">  SoftwareSerial mySerial (rxPin, txPin);</div>
<div class="line">  mySerial.begin(115200);</div>
<div class="line">  CCatcher.init(mySerial, 32);</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>At the top of the <span class="tt">loop()</span> function, before executing anything that might process a command, you need to call the <span class="tt">CommandCatcher.update()</span> method to process the serial queue. This method will not block or wait for input. <br  />
</p>
<div class="fragment"><div class="line">loop() {</div>
<div class="line">  ...</div>
<div class="line">  CCatcher.update();</div>
<div class="line">  ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>The values of the command and parameters will be discarded when you exit the listener function, so if you need them after returning, you need to save them yourself.</p>
<p>You can add multiple listener functions. This might be useful for a larger project consisting of multiple independent modules. By default, the <span class="tt">CommandCatcher</span>can accept up to 4 listeners.</p>
<p>When you add multiple listeners, each listener will be called for every command. It is up to each listener to determine which commands it wants to process.</p>
<p>The <span class="tt">CommandCatcher</span>can be used in <b>Polling</b> mode or in <b>Notification</b> mode.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
Polling Mode</h2>
<p>In polling mode, the sketch uses the <span class="tt">update(false)</span> to prevent the command from bieng closed automatically, and then uses <span class="tt">ready()</span> function to determine if a command is available.</p>
<div class="fragment"><div class="line">void setup() {</div>
<div class="line">  </div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  CCatcher.init();</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {</div>
<div class="line"> </div>
<div class="line">  CCatcher.update(false);</div>
<div class="line">  if (CCatcher.ready()) {</div>
<div class="line">    char* cmd = CCatcher.getCommand();</div>
<div class="line">    char* param = CCatcher.getParameter();</div>
<div class="line">    ... process command ...</div>
<div class="line">    CCatcher.close();</div>
<div class="line">  } else {</div>
<div class="line">    ... do something else ...</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>Note that the <span class="tt">close()</span> function discards the contents of the command and parameter buffer.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md16"></a>
Notification Mode</h2>
<p>To use notification mode, the sketch registers a listener function during <span class="tt">setup()</span> and calls <span class="tt">update(true)</span> (true is the default value of the parameter, so you can use <span class="tt">update()</span> just as well). When a command is available, the listener is called. The listener function must accept two <span class="tt">char*</span> parameters and return <span class="tt">void</span>. The first parameter is the command, and the second is the parameter string.</p>
<div class="fragment"><div class="line">void notify(char* cmd, char* param);</div>
</div><!-- fragment --><p>You can add any free function that satisfies the method signature:</p>
<div class="fragment"><div class="line">void setup() {</div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  CCatcher.init();</div>
<div class="line">  CCatcher.addListener(aListener);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {</div>
<div class="line">  CCatcher.update();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void aListener(char* cmd, char* param) {</div>
<div class="line">  ... process the command ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you want to use a non-static class method as a listener, cou can do that by having your class extend the <span class="tt">CommandListener</span> abstract class and implement its <span class="tt">notify</span> method.</p>
<div class="fragment"><div class="line">class MyClass  : public CommandListener {</div>
<div class="line">  public:</div>
<div class="line">  MyClass();</div>
<div class="line">  void notify(char* cmd, char* param) override;</div>
<div class="line">};</div>
</div><!-- fragment --><p> You can then add an instance of this class as a command listener.</p>
<div class="fragment"><div class="line">MyClass myClass;</div>
<div class="line">void setup() {</div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  CCatcher.init();</div>
<div class="line">  CCatcher.addListener(myClass);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {</div>
<div class="line">  CCatcher.update();</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
